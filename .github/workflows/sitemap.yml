name: Regenerate Sitemap

on:
  schedule:
    # Run daily at 3 AM UTC (4 AM Paris time in winter)
    - cron: '0 3 * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  regenerate-sitemap:
    runs-on: ubuntu-latest

    steps:
    - name: Call sitemap webhook
      run: |
        curl -X POST https://www.prixretro.com/webhooks/sitemap/regenerate \
          -H "X-Sitemap-Token: ${{ secrets.SITEMAP_TOKEN }}" \
          -H "Content-Type: application/json" \
          -f \
          --max-time 300 \
          -v

    - name: Verify sitemap was updated
      run: |
        # Check that sitemap exists and was recently modified
        curl -I https://www.prixretro.com/sitemap.xml \
          -f \
          --max-time 30
